<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hourly RFI Form</title>
  <style>
    :root {
      --bg: #f4f4f5;
      --card: #ffffff;
      --text: #18181b;
      --muted: #52525b;
      --border: #d4d4d8;
      --shadow: 0 14px 40px rgba(24, 24, 27, 0.18);
      --primary: #27272a;
      --primaryHover: #18181b;
      --danger: #dc2626;
      --ring: rgba(24, 24, 27, 0.14);
      --radius: 18px;
      --headerGradA: #27272a;
      --headerGradB: #09090b;
      --theadBg: #f4f4f5;
      --rowAlt: #fafafa;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1100px 420px at 50% -120px, rgba(229,231,235,0.9) 0%, var(--bg) 55%, var(--bg) 100%);
      color: var(--text);
      padding: 28px 18px 44px;
    }

    .container {
      max-width: 980px;
      margin: 0 auto;
    }

    .header {
      background: linear-gradient(180deg, var(--headerGradA) 0%, var(--headerGradB) 100%);
      color: #fff;
      border-radius: var(--radius);
      padding: 22px 20px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.12);
      display: flex;
      gap: 14px;
      align-items: flex-start;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .header h1 {
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .header .sub {
      margin-top: 6px;
      color: rgba(255,255,255,0.86);
      font-size: 13px;
    }

    .header .hint {
      margin-top: 12px;
      color: rgba(255,255,255,0.76);
      font-size: 13px;
      line-height: 1.35;
      max-width: 740px;
    }

    .lang-toggle {
      display: inline-flex;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10);
      border-radius: 14px;
      overflow: hidden;
      height: 40px;
      align-self: flex-start;
    }

    .lang-toggle button {
      height: 40px;
      padding: 0 12px;
      border: none;
      background: transparent;
      color: rgba(255,255,255,0.85);
      font-weight: 900;
      letter-spacing: 0.02em;
      cursor: pointer;
    }

    .lang-toggle button.active {
      background: rgba(255,255,255,0.18);
      color: #fff;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      margin-top: 16px;
    }

    .card-head {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .card h3 {
      margin: 0;
      font-size: 14px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    label {
      display: block;
      font-size: 12px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--muted);
      font-weight: 800;
      margin: 0 0 8px;
    }

    input, select {
      width: 100%;
      height: 44px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      outline: none;
      min-width: 0;
      max-width: 100%;
      transition: box-shadow .15s ease, border-color .15s ease;
      -webkit-appearance: none;
      appearance: none;
    }

    input[type="date"] {
      width: 100%;
      max-width: 100%;
      min-width: 0;
      -webkit-appearance: none;
      appearance: none;
    }

    input:focus, select:focus {
      border-color: #c7cad1;
      box-shadow: 0 0 0 4px var(--ring);
    }

    input[readonly] {
      background: var(--theadBg);
      font-weight: 800;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .grid > div { min-width: 0; }

    @media (min-width: 780px) {
      .grid.two { grid-template-columns: 1fr 1fr; }
      .grid.three { grid-template-columns: 1fr 1fr 1fr; }
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }

    button {
      height: 44px;
      padding: 0 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      font-weight: 900;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: transform .06s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
    }

    button:hover { background: var(--rowAlt); }
    button:active { transform: translateY(1px); }

    .btn-primary {
      background: var(--primary);
      border-color: transparent;
      color: #fff;
      box-shadow: 0 10px 22px rgba(17,24,39,0.18);
    }

    .btn-primary:hover { background: var(--primaryHover); }

    .btn-danger {
      background: #fff;
      border-color: rgba(220,38,38,0.30);
      color: var(--danger);
    }

    .btn-danger:hover { background: rgba(220,38,38,0.06); }

    button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }

    .status {
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.35;
      color: var(--muted);
      white-space: pre-wrap;
    }

    .summary-box {
      border: 1px dashed var(--border);
      border-radius: 14px;
      background: #fafafa;
      padding: 12px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-bottom: 12px;
    }

    @media (min-width: 780px) {
      .summary-box { grid-template-columns: 1fr 1fr; }
    }

    .summary-item {
      font-size: 12px;
      color: var(--text);
      font-weight: 750;
    }

    .summary-item b {
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #374151;
      font-weight: 900;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow: hidden;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: #fff;
    }

    thead th {
      background: var(--theadBg);
      color: #374151;
      font-size: 12px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 12px 10px;
      border-bottom: 1px solid var(--border);
      text-align: center;
      vertical-align: middle;
    }

    tbody td {
      padding: 12px 10px;
      border-bottom: 1px solid var(--border);
      text-align: center;
      font-weight: 650;
      vertical-align: middle;
    }

    tbody tr:last-child td { border-bottom: none; }
    tbody tr:nth-child(even) td { background: var(--rowAlt); }

    .row-actions {
      display: inline-flex;
      gap: 8px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    .row-actions button {
      height: 34px;
      padding: 0 10px;
      border-radius: 12px;
      font-size: 12px;
      letter-spacing: 0.02em;
    }

    .row-actions .btn-primary { box-shadow: none; }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(17, 24, 39, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 1000;
    }

    .modal {
      width: 100%;
      max-width: 520px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .modal-top {
      background: linear-gradient(180deg, var(--headerGradA) 0%, var(--headerGradB) 100%);
      color: #fff;
      padding: 16px 18px;
      font-weight: 900;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      font-size: 14px;
    }

    .modal-body {
      padding: 16px 18px;
      color: var(--text);
    }

    .modal-body .title {
      font-weight: 950;
      font-size: 16px;
      margin: 0 0 10px;
    }

    .modal-body .question {
      margin: 0;
      color: var(--muted);
      font-weight: 750;
    }

    .modal-actions {
      padding: 14px 18px 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      border-top: 1px solid var(--border);
      background: var(--rowAlt);
    }

    .modal-actions button { min-width: 160px; }

    .modal-backdrop.show { display: flex; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="hdrTitle">Request for Information – Hourly Data</h1>
        <div class="sub" id="hdrSub">Hourly information request</div>
        <div class="hint" id="hdrHint">Enter manpower and hours worked for the day. Total hours calculate automatically. Submit when finished.</div>
      </div>
      <div class="lang-toggle" role="group" aria-label="Language">
        <button id="btnEnglish" type="button" class="active">EN</button>
        <button id="btnSpanish" type="button">ES</button>
      </div>
    </div>

    <div class="card">
      <div class="card-head">
        <h3 id="secSubmittedBy">Submitted by</h3>
        <div class="muted" id="secSubmittedByHint">Required before adding or sending data.</div>
      </div>

      <div class="grid two">
        <div>
          <label for="submittedBy" id="lblSubmittedBy">NAME</label>
          <input type="text" id="submittedBy" placeholder="Enter your name" required />
        </div>

        <div>
          <label for="companyName" id="lblCompany">COMPANY</label>
          <input type="text" id="companyName" placeholder="Enter your company" required />
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head">
        <h3 id="secHourly">ENTER HOURLY DATA BELOW:</h3>
        <div class="muted" id="secHourlyHint">Total hours = manpower × hours per person.</div>
      </div>

      <div class="grid two">
        <div>
          <label for="projectName" id="lblProject">PROJECT NAME</label>
          <input type="text" id="projectName" placeholder="Enter project name" required />
        </div>

        <div>
          <label for="taskDescription" id="lblTask">TASK DESCRIPTION</label>
          <input type="text" id="taskDescription" placeholder="Enter task description" required />
        </div>

        <div>
          <label for="date" id="lblDate">DATE</label>
          <input type="date" id="date" />
        </div>

        <div>
          <label for="manpower" id="lblManpower">MANPOWER</label>
          <select id="manpower"></select>
        </div>

        <div>
          <label for="hoursPerPerson" id="lblHPP">HOURS PER PERSON</label>
          <select id="hoursPerPerson"></select>
        </div>

        <div>
          <label for="totalHours" id="lblTotal">TOTAL HOURS</label>
          <input type="text" id="totalHours" readonly />
        </div>
      </div>

      <div class="actions">
        <button class="btn-primary" id="btnEnter" type="button" onclick="addData()">ENTER DATA</button>
        <button type="button" id="btnAddMore" onclick="addMore()">ADD MORE</button>
        <button id="sendBtn" class="btn-primary" type="button" onclick="sendEmail()" disabled>SEND</button>
      </div>

      <div class="status" id="status"></div>
    </div>

    <div class="card" id="submittedCard">
      <div class="card-head">
        <div style="display:flex; gap:10px; align-items:baseline; flex-wrap:wrap;">
          <h3 id="secSubmitted">Data submitted</h3>
          <div class="muted" id="secSubmittedHint">Review entries before sending.</div>
        </div>
      </div>

      <div class="summary-box" id="submittedSummary">
        <div class="summary-item"><b id="sumByLabel">SUBMITTED BY</b>: <span id="sumByValue">—</span></div>
        <div class="summary-item"><b id="sumCompanyLabel">COMPANY</b>: <span id="sumCompanyValue">—</span></div>
      </div>

      <table id="dataTable">
        <thead>
          <tr>
            <th id="thDate">DATE</th>
            <th id="thManpower">MANPOWER</th>
            <th id="thHPP">HOURS PER PERSON</th>
            <th id="thTotal">TOTAL HOURS</th>
            <th id="thActions" class="col-actions">ACTIONS</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="modal-backdrop" id="successModal" role="dialog" aria-modal="true" aria-labelledby="successTitle">
      <div class="modal">
        <div class="modal-top" id="modalTop">Submission</div>
        <div class="modal-body">
          <p class="title" id="successTitle">INFO SUBMITTED SUCCESSFULLY</p>
          <p class="question" id="successQuestion">WOULD YOU LIKE TO ADD ANOTHER PROJECT?</p>
        </div>
        <div class="modal-actions">
          <button id="modalYesBtn" class="btn-primary" type="button">YES</button>
          <button id="modalNoBtn" class="btn-danger" type="button">NO I'M DONE</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const EMAILJS_PUBLIC_KEY = 'Y23YPza-d8mge42dV';
    const EMAILJS_SERVICE_ID = 'service_ryus53s';
    const EMAILJS_TEMPLATE_ID = 'template_ezt4v6o';
    const TO_EMAIL = 'CHARLIE_VILLA@ICLOUD.COM';
    const DONE_URL = 'https://youtu.be/dQw4w9WgXcQ?si=yBKv4_o7GuQ4Js7r';

    const submittedByInput = document.getElementById('submittedBy');
    const companyNameInput = document.getElementById('companyName');

    const projectNameInput = document.getElementById('projectName');
    const taskDescriptionInput = document.getElementById('taskDescription');
    const manpowerSelect = document.getElementById('manpower');
    const hoursPerPersonSelect = document.getElementById('hoursPerPerson');
    const totalHoursInput = document.getElementById('totalHours');
    const statusEl = document.getElementById('status');

    const sumByValue = document.getElementById('sumByValue');
    const sumCompanyValue = document.getElementById('sumCompanyValue');
    const sumByLabel = document.getElementById('sumByLabel');
    const sumCompanyLabel = document.getElementById('sumCompanyLabel');

    const successModal = document.getElementById('successModal');

    const ui = {
      hdrTitle: document.getElementById('hdrTitle'),
      hdrSub: document.getElementById('hdrSub'),
      hdrHint: document.getElementById('hdrHint'),
      btnEnglish: document.getElementById('btnEnglish'),
      btnSpanish: document.getElementById('btnSpanish'),
      secSubmittedBy: document.getElementById('secSubmittedBy'),
      secSubmittedByHint: document.getElementById('secSubmittedByHint'),
      lblSubmittedBy: document.getElementById('lblSubmittedBy'),
      lblCompany: document.getElementById('lblCompany'),
      secHourly: document.getElementById('secHourly'),
      secHourlyHint: document.getElementById('secHourlyHint'),
      lblProject: document.getElementById('lblProject'),
      lblTask: document.getElementById('lblTask'),
      lblDate: document.getElementById('lblDate'),
      lblManpower: document.getElementById('lblManpower'),
      lblHPP: document.getElementById('lblHPP'),
      lblTotal: document.getElementById('lblTotal'),
      btnEnter: document.getElementById('btnEnter'),
      btnAddMore: document.getElementById('btnAddMore'),
      sendBtn: document.getElementById('sendBtn'),
      secSubmitted: document.getElementById('secSubmitted'),
      secSubmittedHint: document.getElementById('secSubmittedHint'),
      thDate: document.getElementById('thDate'),
      thManpower: document.getElementById('thManpower'),
      thHPP: document.getElementById('thHPP'),
      thTotal: document.getElementById('thTotal'),
      thActions: document.getElementById('thActions'),
      modalTop: document.getElementById('modalTop'),
      successTitle: document.getElementById('successTitle'),
      successQuestion: document.getElementById('successQuestion'),
      modalYesBtn: document.getElementById('modalYesBtn'),
      modalNoBtn: document.getElementById('modalNoBtn')
    };

    const strings = {
      en: {
        hdrTitle: 'Request for Information – Hourly Data',
        hdrSub: 'Hourly information request',
        hdrHint: 'Enter manpower and hours worked for the day. Total hours calculate automatically. Submit when finished.',
        secSubmittedBy: 'Submitted by',
        secSubmittedByHint: 'Required before adding or sending data.',
        lblSubmittedBy: 'NAME',
        lblCompany: 'COMPANY',
        sumByLabel: 'SUBMITTED BY',
        sumCompanyLabel: 'COMPANY',
        secHourly: 'ENTER HOURLY DATA BELOW:',
        secHourlyHint: 'Total hours = manpower × hours per person.',
        lblProject: 'PROJECT NAME',
        lblTask: 'TASK DESCRIPTION',
        lblDate: 'DATE',
        lblManpower: 'MANPOWER',
        lblHPP: 'HOURS PER PERSON',
        lblTotal: 'TOTAL HOURS',
        btnEnter: 'ENTER DATA',
        btnAddMore: 'ADD MORE',
        send: 'SEND',
        secSubmitted: 'Data submitted',
        secSubmittedHint: 'Review entries before sending.',
        thDate: 'DATE',
        thManpower: 'MANPOWER',
        thHPP: 'HOURS PER PERSON',
        thTotal: 'TOTAL HOURS',
        thActions: 'ACTIONS',
        edit: 'EDIT',
        save: 'SAVE',
        cancel: 'CANCEL',
        modalTop: 'Submission',
        successTitle: 'INFO SUBMITTED SUCCESSFULLY',
        successQuestion: 'WOULD YOU LIKE TO ADD ANOTHER PROJECT?',
        yes: 'YES',
        no: "NO I'M DONE",
        alerts: {
          submittedByRequired: 'NAME is required',
          companyRequired: 'COMPANY is required',
          projectRequired: 'PROJECT NAME is required',
          taskRequired: 'TASK DESCRIPTION is required',
          completeAll: 'Please complete all fields',
          noData: 'No data to send',
          duplicateDate: 'That date has already been entered. Please choose a different date.',
          emailNotReady: 'Email service is not ready yet. Please wait a moment and try again.',
          emailLibMissing: 'EmailJS library did not load.',
          emailFailed: 'Email failed to send.'
        }
      },
      es: {
        hdrTitle: 'Solicitud de información – Horas',
        hdrSub: 'Solicitud de información por hora',
        hdrHint: 'Ingrese la mano de obra y las horas trabajadas del día. Las horas totales se calculan automáticamente. Envíe cuando termine.',
        secSubmittedBy: 'Enviado por',
        secSubmittedByHint: 'Requerido antes de agregar o enviar datos.',
        lblSubmittedBy: 'NOMBRE',
        lblCompany: 'COMPAÑÍA',
        sumByLabel: 'ENVIADO POR',
        sumCompanyLabel: 'COMPAÑÍA',
        secHourly: 'INGRESE LOS DATOS DE HORAS A CONTINUACIÓN:',
        secHourlyHint: 'Horas totales = mano de obra × horas por persona.',
        lblProject: 'NOMBRE DEL PROYECTO',
        lblTask: 'DESCRIPCIÓN DE LA TAREA',
        lblDate: 'FECHA',
        lblManpower: 'MANO DE OBRA',
        lblHPP: 'HORAS POR PERSONA',
        lblTotal: 'HORAS TOTALES',
        btnEnter: 'AGREGAR',
        btnAddMore: 'AGREGAR MÁS',
        send: 'ENVIAR',
        secSubmitted: 'Datos enviados',
        secSubmittedHint: 'Revise las entradas antes de enviar.',
        thDate: 'FECHA',
        thManpower: 'MANO DE OBRA',
        thHPP: 'HORAS POR PERSONA',
        thTotal: 'HORAS TOTALES',
        thActions: 'ACCIONES',
        edit: 'EDITAR',
        save: 'GUARDAR',
        cancel: 'CANCELAR',
        modalTop: 'Envío',
        successTitle: 'INFORMACIÓN ENVIADA CON ÉXITO',
        successQuestion: '¿DESEA AGREGAR OTRO PROYECTO?',
        yes: 'SÍ',
        no: 'NO, YA TERMINÉ',
        alerts: {
          submittedByRequired: 'El NOMBRE es obligatorio',
          companyRequired: 'La COMPAÑÍA es obligatoria',
          projectRequired: 'El NOMBRE DEL PROYECTO es obligatorio',
          taskRequired: 'La DESCRIPCIÓN DE LA TAREA es obligatoria',
          completeAll: 'Por favor complete todos los campos',
          noData: 'No hay datos para enviar',
          duplicateDate: 'Esa fecha ya fue ingresada. Por favor elija una fecha diferente.',
          emailNotReady: 'El servicio de correo no está listo.',
          emailLibMissing: 'No se cargó la librería de EmailJS.',
          emailFailed: 'No se pudo enviar el correo.'
        }
      }
    };

    let currentLang = 'en';

    function currentStrings() {
      return strings[currentLang] || strings.en;
    }

    function setLanguage(lang) {
      const s = strings[lang] || strings.en;
      currentLang = strings[lang] ? lang : 'en';

      ui.hdrTitle.textContent = s.hdrTitle;
      ui.hdrSub.textContent = s.hdrSub;
      ui.hdrHint.textContent = s.hdrHint;

      ui.secSubmittedBy.textContent = s.secSubmittedBy;
      ui.secSubmittedByHint.textContent = s.secSubmittedByHint;
      ui.lblSubmittedBy.textContent = s.lblSubmittedBy;
      ui.lblCompany.textContent = s.lblCompany;
      sumByLabel.textContent = s.sumByLabel;
      sumCompanyLabel.textContent = s.sumCompanyLabel;

      ui.secHourly.textContent = s.secHourly;
      ui.secHourlyHint.textContent = s.secHourlyHint;

      ui.lblProject.textContent = s.lblProject;
      ui.lblTask.textContent = s.lblTask;
      ui.lblDate.textContent = s.lblDate;
      ui.lblManpower.textContent = s.lblManpower;
      ui.lblHPP.textContent = s.lblHPP;
      ui.lblTotal.textContent = s.lblTotal;

      ui.btnEnter.textContent = s.btnEnter;
      ui.btnAddMore.textContent = s.btnAddMore;
      ui.sendBtn.textContent = s.send;

      ui.secSubmitted.textContent = s.secSubmitted;
      ui.secSubmittedHint.textContent = s.secSubmittedHint;

      ui.thDate.textContent = s.thDate;
      ui.thManpower.textContent = s.thManpower;
      ui.thHPP.textContent = s.thHPP;
      ui.thTotal.textContent = s.thTotal;
      ui.thActions.textContent = s.thActions;

      ui.modalTop.textContent = s.modalTop;
      ui.successTitle.textContent = s.successTitle;
      ui.successQuestion.textContent = s.successQuestion;
      ui.modalYesBtn.textContent = s.yes;
      ui.modalNoBtn.textContent = s.no;

      ui.btnEnglish.classList.toggle('active', currentLang === 'en');
      ui.btnSpanish.classList.toggle('active', currentLang === 'es');

      refreshActionLabels();
      updateSubmittedSummary();
    }

    function refreshActionLabels() {
      const s = currentStrings();
      const rows = document.querySelectorAll('#dataTable tbody tr');
      rows.forEach(r => {
        const editBtn = r.querySelector('button[data-action="edit"]');
        const saveBtn = r.querySelector('button[data-action="save"]');
        const cancelBtn = r.querySelector('button[data-action="cancel"]');
        if (editBtn) editBtn.textContent = s.edit;
        if (saveBtn) saveBtn.textContent = s.save;
        if (cancelBtn) cancelBtn.textContent = s.cancel;
      });
    }

    document.getElementById('btnEnglish').addEventListener('click', () => setLanguage('en'));
    document.getElementById('btnSpanish').addEventListener('click', () => setLanguage('es'));

    function tAlert(key) {
      const s = strings[currentLang] || strings.en;
      return (s.alerts && s.alerts[key]) ? s.alerts[key] : ((strings.en.alerts && strings.en.alerts[key]) ? strings.en.alerts[key] : '');
    }

    let emailJsLibLoaded = false;
    let emailJsReady = false;

    function setStatus(msg, isError = false) {
      statusEl.textContent = msg;
      statusEl.style.color = isError ? '#dc2626' : '#065f46';
    }

    function updateSubmittedSummary() {
      const by = (submittedByInput.value || '').trim();
      const company = (companyNameInput.value || '').trim();
      sumByValue.textContent = by ? by : '—';
      sumCompanyValue.textContent = company ? company : '—';
    }

    submittedByInput.addEventListener('input', updateSubmittedSummary);
    companyNameInput.addEventListener('input', updateSubmittedSummary);

    function addOption(selectEl, value) {
      const opt = document.createElement('option');
      opt.value = String(value);
      opt.textContent = String(value);
      selectEl.appendChild(opt);
    }

    for (let i = 1; i <= 15; i++) {
      addOption(manpowerSelect, i);
      addOption(hoursPerPersonSelect, i);
    }

    function computeAndDisplayTotalHours() {
      const mp = Number(manpowerSelect.value || 0);
      const hpp = Number(hoursPerPersonSelect.value || 0);
      const total = mp * hpp;
      totalHoursInput.value = total > 0 ? String(total) : '';
      return total;
    }

    manpowerSelect.addEventListener('change', computeAndDisplayTotalHours);
    hoursPerPersonSelect.addEventListener('change', computeAndDisplayTotalHours);

    function showSuccessModal() {
      successModal.classList.add('show');
    }

    function hideSuccessModal() {
      successModal.classList.remove('show');
    }

    ui.modalYesBtn.addEventListener('click', () => {
      hideSuccessModal();
      window.location.reload();
    });

    ui.modalNoBtn.addEventListener('click', () => {
      hideSuccessModal();
      try {
        if (window.top && window.top !== window) {
          window.top.location.href = DONE_URL;
        } else {
          window.location.assign(DONE_URL);
        }
      } catch (e) {
        window.location.assign(DONE_URL);
      }
    });

    successModal.addEventListener('click', (e) => {
      if (e.target === successModal) hideSuccessModal();
    });

    function validateSubmittedByFields() {
      const submittedBy = (submittedByInput.value || '').trim();
      const company = (companyNameInput.value || '').trim();

      if (!submittedBy) {
        alert(tAlert('submittedByRequired'));
        submittedByInput.focus();
        return null;
      }

      if (!company) {
        alert(tAlert('companyRequired'));
        companyNameInput.focus();
        return null;
      }

      return { submittedBy, company };
    }

    function validateProjectFields() {
      const projectName = (projectNameInput.value || '').trim();
      const taskDescription = (taskDescriptionInput.value || '').trim();

      if (!projectName) {
        alert(tAlert('projectRequired'));
        projectNameInput.focus();
        return null;
      }

      if (!taskDescription) {
        alert(tAlert('taskRequired'));
        taskDescriptionInput.focus();
        return null;
      }

      return { projectName, taskDescription };
    }

    function formatDateMDY(isoDate) {
      if (!isoDate) return '';
      const parts = isoDate.split('-');
      if (parts.length !== 3) return isoDate;
      const year = parts[0];
      const month = parts[1];
      const day = parts[2];
      return month + '-' + day + '-' + year;
    }

    function formatHoursLabel(value) {
      const n = Number(value);
      if (!Number.isFinite(n)) return String(value);
      return n === 1 ? (String(n) + ' HOUR') : (String(n) + ' HOURS');
    }

    function isDateDuplicate(isoDate, excludeRow) {
      if (!isoDate) return false;
      const tbody = document.querySelector('#dataTable tbody');
      const rows = tbody ? Array.from(tbody.querySelectorAll('tr')) : [];
      for (const r of rows) {
        if (excludeRow && r === excludeRow) continue;
        const iso = r.dataset ? r.dataset.isoDate : '';
        if (iso && iso === isoDate) return true;
      }
      return false;
    }

    function createActionsCell(row) {
      const s = currentStrings();
      const cell = row.insertCell(4);
      cell.className = 'col-actions';

      const wrap = document.createElement('div');
      wrap.className = 'row-actions';

      const editBtn = document.createElement('button');
      editBtn.type = 'button';
      editBtn.textContent = s.edit;
      editBtn.dataset.action = 'edit';
      editBtn.addEventListener('click', () => beginEditRow(row));

      const saveBtn = document.createElement('button');
      saveBtn.type = 'button';
      saveBtn.textContent = s.save;
      saveBtn.dataset.action = 'save';
      saveBtn.className = 'btn-primary';
      saveBtn.style.display = 'none';
      saveBtn.addEventListener('click', () => saveEditRow(row));

      const cancelBtn = document.createElement('button');
      cancelBtn.type = 'button';
      cancelBtn.textContent = s.cancel;
      cancelBtn.dataset.action = 'cancel';
      cancelBtn.style.display = 'none';
      cancelBtn.addEventListener('click', () => cancelEditRow(row));

      wrap.appendChild(editBtn);
      wrap.appendChild(saveBtn);
      wrap.appendChild(cancelBtn);
      cell.appendChild(wrap);

      return cell;
    }

    function setRowDisplay(row, isoDate, mp, hpp) {
      const total = Number(mp) * Number(hpp);
      row.dataset.isoDate = isoDate;
      row.dataset.manpower = String(mp);
      row.dataset.hpp = String(hpp);
      row.dataset.total = String(total);

      row.cells[0].textContent = formatDateMDY(isoDate);
      row.cells[1].textContent = formatHoursLabel(mp);
      row.cells[2].textContent = formatHoursLabel(hpp);
      row.cells[3].textContent = formatHoursLabel(total);
    }

    function beginEditRow(row) {
      if (!row || row.dataset.editing === '1') return;

      const tbody = document.querySelector('#dataTable tbody');
      Array.from(tbody.querySelectorAll('tr')).forEach(r => {
        if (r !== row && r.dataset.editing === '1') cancelEditRow(r);
      });

      row.dataset.editing = '1';
      row.dataset.originalIso = row.dataset.isoDate || '';
      row.dataset.originalMp = row.dataset.manpower || '';
      row.dataset.originalHpp = row.dataset.hpp || '';

      const iso = row.dataset.isoDate || '';
      const mp = row.dataset.manpower || '1';
      const hpp = row.dataset.hpp || '1';

      row.cells[0].textContent = formatDateMDY(iso);

      const mpSelect = document.createElement('select');
      mpSelect.style.height = '38px';
      for (let i = 1; i <= 15; i++) {
        const opt = document.createElement('option');
        opt.value = String(i);
        opt.textContent = String(i);
        if (String(i) === String(mp)) opt.selected = true;
        mpSelect.appendChild(opt);
      }

      const hppSelect = document.createElement('select');
      hppSelect.style.height = '38px';
      for (let i = 1; i <= 15; i++) {
        const opt = document.createElement('option');
        opt.value = String(i);
        opt.textContent = String(i);
        if (String(i) === String(hpp)) opt.selected = true;
        hppSelect.appendChild(opt);
      }

      const totalInput = document.createElement('input');
      totalInput.type = 'text';
      totalInput.readOnly = true;
      totalInput.style.height = '38px';

      function recalc() {
        const t = Number(mpSelect.value || 0) * Number(hppSelect.value || 0);
        totalInput.value = t > 0 ? formatHoursLabel(t) : '';
      }

      mpSelect.addEventListener('change', recalc);
      hppSelect.addEventListener('change', recalc);

      row.cells[1].textContent = '';
      row.cells[1].appendChild(mpSelect);

      row.cells[2].textContent = '';
      row.cells[2].appendChild(hppSelect);

      row.cells[3].textContent = '';
      row.cells[3].appendChild(totalInput);

      recalc();

      const editBtn = row.querySelector('button[data-action="edit"]');
      const saveBtn = row.querySelector('button[data-action="save"]');
      const cancelBtn = row.querySelector('button[data-action="cancel"]');
      if (editBtn) editBtn.style.display = 'none';
      if (saveBtn) saveBtn.style.display = '';
      if (cancelBtn) cancelBtn.style.display = '';

      refreshActionLabels();
    }

    function cancelEditRow(row) {
      if (!row || row.dataset.editing !== '1') return;
      const iso = row.dataset.originalIso || row.dataset.isoDate || '';
      const mp = row.dataset.originalMp || row.dataset.manpower || '1';
      const hpp = row.dataset.originalHpp || row.dataset.hpp || '1';

      row.dataset.editing = '0';
      delete row.dataset.originalIso;
      delete row.dataset.originalMp;
      delete row.dataset.originalHpp;

      setRowDisplay(row, iso, mp, hpp);

      const editBtn = row.querySelector('button[data-action="edit"]');
      const saveBtn = row.querySelector('button[data-action="save"]');
      const cancelBtn = row.querySelector('button[data-action="cancel"]');
      if (editBtn) editBtn.style.display = '';
      if (saveBtn) saveBtn.style.display = 'none';
      if (cancelBtn) cancelBtn.style.display = 'none';

      refreshActionLabels();
    }

    function saveEditRow(row) {
      if (!row || row.dataset.editing !== '1') return;

      const mpEl = row.cells[1].querySelector('select');
      const hppEl = row.cells[2].querySelector('select');

      const iso = row.dataset.isoDate || '';
      const mp = mpEl ? mpEl.value : '';
      const hpp = hppEl ? hppEl.value : '';

      if (!iso || !mp || !hpp) {
        alert(tAlert('completeAll'));
        return;
      }

      row.dataset.editing = '0';
      delete row.dataset.originalIso;
      delete row.dataset.originalMp;
      delete row.dataset.originalHpp;

      setRowDisplay(row, iso, mp, hpp);

      const editBtn = row.querySelector('button[data-action="edit"]');
      const saveBtn = row.querySelector('button[data-action="save"]');
      const cancelBtn = row.querySelector('button[data-action="cancel"]');
      if (editBtn) editBtn.style.display = '';
      if (saveBtn) saveBtn.style.display = 'none';
      if (cancelBtn) cancelBtn.style.display = 'none';

      refreshActionLabels();
    }

    function addData() {
      const headerOk = validateSubmittedByFields();
      if (!headerOk) return;

      const ok = validateProjectFields();
      if (!ok) return;

      const date = document.getElementById('date').value;
      const manpower = manpowerSelect.value;
      const hoursPerPerson = hoursPerPersonSelect.value;
      computeAndDisplayTotalHours();

      if (!date || !hoursPerPerson) {
        alert(tAlert('completeAll'));
        return;
      }

      if (isDateDuplicate(date, null)) {
        alert(tAlert('duplicateDate'));
        return;
      }

      const table = document.querySelector('#dataTable tbody');
      const row = table.insertRow();

      row.insertCell(0);
      row.insertCell(1);
      row.insertCell(2);
      row.insertCell(3);
      createActionsCell(row);

      setRowDisplay(row, date, manpower, hoursPerPerson);
      updateSubmittedSummary();
      setStatus('');
    }

    function clearEntryFields() {
      document.getElementById('date').value = '';
      manpowerSelect.selectedIndex = 0;
      hoursPerPersonSelect.selectedIndex = 0;
      totalHoursInput.value = '';
    }

    function resetFields() {
      submittedByInput.value = '';
      companyNameInput.value = '';
      projectNameInput.value = '';
      taskDescriptionInput.value = '';
      clearEntryFields();
      updateSubmittedSummary();
      setStatus('');
    }

    function addMore() {
      addData();
      clearEntryFields();
    }

    function buildTableDataText() {
      const rows = document.querySelectorAll('#dataTable tbody tr');
      if (rows.length === 0) return '';

      let tableData = 'DATE | MANPOWER | HOURS PER PERSON | TOTAL HOURS\n';
      tableData += '-----------------------------------------------\n';

      rows.forEach(row => {
        const cols = row.querySelectorAll('td');
        const d = cols[0] ? cols[0].innerText : '';
        const mp = cols[1] ? cols[1].innerText : '';
        const hpp = cols[2] ? cols[2].innerText : '';
        const t = cols[3] ? cols[3].innerText : '';
        tableData += d + ' | ' + mp + ' | ' + hpp + ' | ' + t + '\n';
      });

      return tableData;
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function formatGeneratedStamp() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      let hr = d.getHours();
      const min = String(d.getMinutes()).padStart(2, '0');
      const ampm = hr >= 12 ? 'PM' : 'AM';
      hr = hr % 12;
      hr = hr ? hr : 12;
      const h = String(hr).padStart(2, '0');
      return m + '-' + day + '-' + y + ' ' + h + ':' + min + ' ' + ampm;
    }

    function buildReportHtml(submittedBy, company, projectName, taskDescription) {
      const rows = Array.from(document.querySelectorAll('#dataTable tbody tr'));
      const generated = formatGeneratedStamp();
      const rowCount = rows.length;

      const header =
        '<div style="border:1px solid #d4d4d8;border-radius:14px;padding:14px;background:#f4f4f5;margin:0 0 14px;">' +
          '<div style="font-weight:950;letter-spacing:0.02em;text-transform:uppercase;margin:0 0 8px;font-size:14px;color:#18181b;">Hourly RFI Submission</div>' +
          '<div style="display:grid;grid-template-columns:1fr;gap:8px;font-size:12px;color:#18181b;">' +
            '<div><b style="text-transform:uppercase;letter-spacing:0.05em;color:#374151;">SUBMITTED BY</b>: ' + escapeHtml(submittedBy) + '</div>' +
            '<div><b style="text-transform:uppercase;letter-spacing:0.05em;color:#374151;">COMPANY</b>: ' + escapeHtml(company) + '</div>' +
            '<div><b style="text-transform:uppercase;letter-spacing:0.05em;color:#374151;">PROJECT NAME</b>: ' + escapeHtml(projectName) + '</div>' +
            '<div><b style="text-transform:uppercase;letter-spacing:0.05em;color:#374151;">TASK DESCRIPTION</b>: ' + escapeHtml(taskDescription) + '</div>' +
            '<div><b style="text-transform:uppercase;letter-spacing:0.05em;color:#374151;">GENERATED</b>: ' + escapeHtml(generated) + '</div>' +
            '<div><b style="text-transform:uppercase;letter-spacing:0.05em;color:#374151;">ENTRIES</b>: ' + escapeHtml(String(rowCount)) + '</div>' +
          '</div>' +
        '</div>';

      const thead =
        '<thead>' +
          '<tr>' +
            '<th style="background:#f4f4f5;color:#374151;font-size:12px;letter-spacing:0.06em;text-transform:uppercase;padding:12px 10px;border-bottom:1px solid #d4d4d8;text-align:center;">DATE</th>' +
            '<th style="background:#f4f4f5;color:#374151;font-size:12px;letter-spacing:0.06em;text-transform:uppercase;padding:12px 10px;border-bottom:1px solid #d4d4d8;text-align:center;">MANPOWER</th>' +
            '<th style="background:#f4f4f5;color:#374151;font-size:12px;letter-spacing:0.06em;text-transform:uppercase;padding:12px 10px;border-bottom:1px solid #d4d4d8;text-align:center;">HOURS PER PERSON</th>' +
            '<th style="background:#f4f4f5;color:#374151;font-size:12px;letter-spacing:0.06em;text-transform:uppercase;padding:12px 10px;border-bottom:1px solid #d4d4d8;text-align:center;">TOTAL HOURS</th>' +
          '</tr>' +
        '</thead>';

      let tbody = '<tbody>';
      rows.forEach((row, idx) => {
        const c = row.querySelectorAll('td');
        const alt = idx % 2 === 1 ? 'background:#fafafa;' : '';
        const d = c[0] ? c[0].innerText : '';
        const mp = c[1] ? c[1].innerText : '';
        const hpp = c[2] ? c[2].innerText : '';
        const t = c[3] ? c[3].innerText : '';
        tbody +=
          '<tr>' +
            '<td style="padding:12px 10px;border-bottom:1px solid #d4d4d8;text-align:center;font-weight:650;vertical-align:middle;' + alt + '">' + escapeHtml(d) + '</td>' +
            '<td style="padding:12px 10px;border-bottom:1px solid #d4d4d8;text-align:center;font-weight:650;vertical-align:middle;' + alt + '">' + escapeHtml(mp) + '</td>' +
            '<td style="padding:12px 10px;border-bottom:1px solid #d4d4d8;text-align:center;font-weight:650;vertical-align:middle;' + alt + '">' + escapeHtml(hpp) + '</td>' +
            '<td style="padding:12px 10px;border-bottom:1px solid #d4d4d8;text-align:center;font-weight:650;vertical-align:middle;' + alt + '">' + escapeHtml(t) + '</td>' +
          '</tr>';
      });
      tbody += '</tbody>';

      const table =
        '<table style="width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border:1px solid #d4d4d8;border-radius:14px;background:#ffffff;">' +
          thead +
          tbody +
        '</table>';

      return '<div style="font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;">' + header + table + '</div>';
    }

    function buildEmailText(submittedBy, company, projectName, taskDescription) {
      const tableData = buildTableDataText();
      if (!tableData) return '';
      return 'SUBMITTED BY: ' + submittedBy + '\nCOMPANY: ' + company + '\n\nPROJECT NAME: ' + projectName + '\nTASK DESCRIPTION: ' + taskDescription + '\n\n' + tableData;
    }

    function getRowCount() {
      return document.querySelectorAll('#dataTable tbody tr').length;
    }

    function loadEmailJsLibrary() {
      const existing = document.querySelector('script[data-emailjs="1"]');
      if (existing) return;

      const script = document.createElement('script');
      script.dataset.emailjs = '1';
      script.src = 'https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js';
      script.async = true;

      script.onload = function () {
        emailJsLibLoaded = true;
        tryInitEmailJs();
      };

      script.onerror = function () {
        emailJsLibLoaded = false;
        emailJsReady = false;
        ui.sendBtn.disabled = true;
        setStatus('Failed to load EmailJS library (network error).', true);
      };

      document.head.appendChild(script);
    }

    function tryInitEmailJs() {
      emailJsReady = false;
      ui.sendBtn.disabled = true;

      if (!emailJsLibLoaded) {
        setStatus('Loading email service…');
        return;
      }

      try {
        if (typeof emailjs === 'undefined' || !emailjs || typeof emailjs.init !== 'function') {
          setStatus('EmailJS library did not initialize correctly. Try reloading the page.', true);
          return;
        }
        emailjs.init(EMAILJS_PUBLIC_KEY);
        emailJsReady = true;
        ui.sendBtn.disabled = false;
        setStatus('Email service ready ✅');
      } catch (e) {
        emailJsReady = false;
        ui.sendBtn.disabled = true;
        setStatus('Email service failed to initialize.', true);
      }
    }

    function sendEmail() {
      if (!emailJsReady) {
        alert(tAlert('emailNotReady'));
        return;
      }

      if (typeof emailjs === 'undefined') {
        setStatus('EmailJS library is not available. Check your network connection.', true);
        alert(tAlert('emailLibMissing'));
        return;
      }

      const headerOk = validateSubmittedByFields();
      if (!headerOk) return;

      const ok = validateProjectFields();
      if (!ok) return;

      const rowCount = getRowCount();
      if (!rowCount) {
        alert(tAlert('noData'));
        return;
      }

      const textMessage = buildEmailText(headerOk.submittedBy, headerOk.company, ok.projectName, ok.taskDescription);
      const htmlReport = buildReportHtml(headerOk.submittedBy, headerOk.company, ok.projectName, ok.taskDescription);

      const templateParams = {
        to_email: TO_EMAIL,
        to: TO_EMAIL,
        subject: 'Hourly RFI Submission',
        name: headerOk.submittedBy,
        company: headerOk.company,
        message: textMessage,
        message_text: textMessage,
        html_report: htmlReport
      };

      setStatus('Sending email…');
      ui.sendBtn.disabled = true;

      emailjs
        .send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams)
        .then(() => {
          setStatus('Email sent successfully');
          document.querySelector('#dataTable tbody').innerHTML = '';
          resetFields();
          showSuccessModal();
        })
        .catch(error => {
          const detail = (error && (error.text || error.message)) ? (error.text || error.message) : JSON.stringify(error);
          setStatus(
            'Email failed to send. Most common causes: (1) wrong Service ID/Template ID, (2) template missing variables (to_email/message/html_report), or (3) this domain not allowed in EmailJS. Error detail: ' + detail,
            true
          );
          alert(tAlert('emailFailed'));
        })
        .finally(() => {
          ui.sendBtn.disabled = !emailJsReady;
        });
    }

    function runTests() {
      try {
        console.assert(typeof buildReportHtml === 'function', 'buildReportHtml should be defined');
        console.assert(typeof buildTableDataText === 'function', 'buildTableDataText should be defined');
        console.assert(typeof buildEmailText === 'function', 'buildEmailText should be defined');
        console.assert(typeof showSuccessModal === 'function', 'showSuccessModal should be defined');
        console.assert(manpowerSelect.options.length === 15, 'Manpower dropdown should have 15 options');
        console.assert(hoursPerPersonSelect.options.length === 15, 'Hours Per Person dropdown should have 15 options');

        setLanguage('en');
        console.assert(ui.secSubmittedBy.textContent.toLowerCase().indexOf('submitted') !== -1, 'Submitted by section should be EN');
        setLanguage('es');
        console.assert(ui.secSubmittedBy.textContent.toLowerCase().indexOf('enviado') !== -1, 'Submitted by section should be ES');
        setLanguage('en');

        submittedByInput.value = 'Test Person';
        companyNameInput.value = 'Test Company';
        updateSubmittedSummary();
        console.assert(sumByValue.textContent === 'Test Person', 'Summary submitted by should reflect input');
        console.assert(sumCompanyValue.textContent === 'Test Company', 'Summary company should reflect input');

        manpowerSelect.value = '3';
        hoursPerPersonSelect.value = '4';
        const t = computeAndDisplayTotalHours();
        console.assert(t === 12, 'Total hours should equal manpower * hours per person');

        const tbody = document.querySelector('#dataTable tbody');
        tbody.innerHTML = '';
        const savedAlert = window.alert;
        window.alert = function () {};

        projectNameInput.value = 'Test Project';
        taskDescriptionInput.value = 'Test Task';
        document.getElementById('date').value = '2025-12-24';
        manpowerSelect.value = '2';
        hoursPerPersonSelect.value = '3';
        addData();
        console.assert(tbody.querySelectorAll('tr').length === 1, 'Should insert first row');

        const r = tbody.querySelector('tr');
        console.assert(r.cells[0].innerText === '12-24-2025', 'Date should be displayed as MM-DD-YYYY');

        const text = buildEmailText('Test Person', 'Test Company', 'Test Project', 'Test Task');
        console.assert(text.indexOf('\n') !== -1, 'Email text should contain newline escapes');

        const html = buildReportHtml('Test Person', 'Test Company', 'Test Project', 'Test Task');
        console.assert(html.indexOf('SUBMITTED BY') !== -1, 'Report HTML should include submitted by');
        console.assert(html.indexOf('COMPANY') !== -1, 'Report HTML should include company');

        tbody.innerHTML = '';
        window.alert = savedAlert;
      } catch (e) {
      } finally {
        resetFields();
      }
    }

    setLanguage('en');
    computeAndDisplayTotalHours();
    updateSubmittedSummary();
    loadEmailJsLibrary();
    runTests();
  </script>
</body>
</html>
